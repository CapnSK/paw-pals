# Define the stages that jobs will be assigned to
stages:
  - build
  - code-quality
  - test
  - deploy

# Job to detect code smells in the codebase
code-smell-backend:
  stage: code-quality
  only:
    - dev  # Only run this job in the 'dev' branch
  script:
    - echo "Detecting code smells..."  # Output a message indicating the job is running
  when: manual  # Require manual intervention to run this job
  tags:
    - ugrad  # Run this job on a runner with the 'ugrad' tag

# Job to build the backend code
build-backend:
  stage: build
  image: maven:3-jdk-17  # Use the maven:3-jdk-17 Docker image for this job
  only:
    - dev
  script:
    - echo "Building backend..."
  when: manual
  tags:
    - ugrad

# Job to build the frontend code
build-frontend:
  stage: build
  only:
    - dev
  script:
    - echo "Building frontend..."
    - cd frontend  # Change to the 'frontend' directory
    - npm install  # Install the required dependencies
    - npm run build  # Build the frontend code
  when: manual
  tags:
    - ugrad

# Job to test the backend code
test-backend:
  stage: test
  only:
    - dev
  script:
    - echo "Testing backend..."
    - cd backend/paw-pals
    - mvn clean
  when: manual
  tags:
    - ugrad

# Job to deploy the backend code
deploy-backend:
  stage: deploy
  only:
    - dev
  script:
    - echo "Deploying backend..."
  when: manual
  tags:
    - ugrad

# Job to deploy the frontend code
deploy-frontend:
  stage: deploy
  only:
    - dev
  script:
    - echo "Deploying frontend..."
  when: manual
  tags:
    - ugrad